---
title: "Potenciais Evocados"
author: "Amanda Yumi"
date: "30 de setembro de 2018"
output: html_document
weight: 30
---



<pre class="r"><code># Leitura dos dados
sinais=read.table(&quot;oddball250hz.txt&quot;,header=FALSE)</code></pre>
<p>Para continuar a leitura dos filtros, deve-se realizar a leitura dos dados de canais também disponibilizados:</p>
<pre class="r"><code># Leitura dos canais de EEG:
nomes=scan(&quot;nomecanais.txt&quot;, what = &quot;string&quot;)</code></pre>
<p>Ao analisar o arquivo dos sinais, é possível verificar que a coluna 33 não se trata de sinais cerebrais, mas sim, a referência dos triggers (marcações do experimento). Dessa forma, realiza-se a leitura dos sinais e dos triggers, armazenando em matrizes separadas:</p>
<pre class="r"><code># Separar o trigger dos sinais
# Jogo fora o sinal 33 porque não é dado cerrebral
trigger = sinais[,33]
sinais= sinais[,1:32]</code></pre>
<p>Analisando a matriz trigger com o comando table, é possível verificar os tipos de eventos existentes no experimento (eventos raros marcados por 10 e frequentes marcados por 11):</p>
<pre class="r"><code># Lendo o conteúdo do trigger:
# esse comendo mostra o número de observações de cada tipo
table(trigger)</code></pre>
<pre><code>## trigger
##     0    10    11 
## 45422    10    29</code></pre>
<p>Olhando o conteúdo do trigger:</p>
<pre><code>## [1] 5.1 4.1 4.1 2.1</code></pre>
<pre class="r"><code># Conteúdo do vetor do trigger:
ts.plot(trigger)</code></pre>
<p><img src="/aulas/3_PotenciaisEvocados_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<p>Para identificação dos potenciais evocados, precisamos ainda definir os canais e pontos no tempo:</p>
<pre class="r"><code># Número de canais:
Ncanais =ncol(sinais)

# Número de pontos no tempo:
T=nrow(sinais)</code></pre>
<p>Filtrando os sinais de todos os canais:</p>
<pre class="r"><code>FILTRO = butter(n=5, W =c(1,40)/(HZ/2), type = &quot;pass&quot;)
freqz(FILTRO)</code></pre>
<p><img src="/aulas/3_PotenciaisEvocados_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
<pre class="r"><code>fsinais = matrix(0, nrow(sinais), ncol(sinais))

for (canal in 1:32) {
  y = sinais[,canal] - mean(sinais[,canal])
  fsinais[,canal]=filter(FILTRO,y)
}
plot((1:nrow(sinais))/HZ,sinais[,1]-mean(sinais[,1]),type=&quot;l&quot;,xlab=&quot;Tempo(s)&quot;, ylab=&quot;sinal(uV)&quot;)
lines((1:nrow(sinais))/HZ,fsinais[,1],col=2)</code></pre>
<p><img src="/aulas/3_PotenciaisEvocados_files/figure-html/unnamed-chunk-9-2.png" width="672" /></p>
<p>Considerando a taxa de amostragem de 250hz, quero calcular uma determinada janela no intervalo 100ms dado um canal:</p>
<pre class="r"><code># Se a taxa de amostragem é 250, quero definir as janelas pré e pós estímulos:
JANELApos=HZ        #janela de 1 segundo
JANELApre=HZ/10    #janela de 100 milisegundos</code></pre>
<p>O comando which ajuda a separar os estímulos:</p>
<pre class="r"><code>#Descobrir quais as caselas do vetor trigger se referem ao estimulo freq e raro
TiRaros= which(trigger==10)
TiFreq= which(trigger==11)</code></pre>
<p>Armazenando os potenciais evocados:</p>
<pre class="r"><code># Matriz que guarda os potenciais evocados medios do estimulo raro
PEraro = matrix(0,276,Ncanais)

# for pra cada canal
for(canal in 1:Ncanais){
  MediaRaro = 0
  # pra todo ti
  for(ti in TiRaros){
    Baseline = mean(fsinais[(ti-JANELApre):ti, canal])
    y = fsinais[(ti-JANELApre):(ti+JANELApos), canal] - Baseline
    MediaRaro = MediaRaro + y/length(TiRaros)
  } 
  PEraro[,canal] = MediaRaro
}</code></pre>
